pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
b={}
for i=1,10 do
	-- x,y,dx,dy
	b[i]={rnd(127),rnd(127),rnd(5)-2.5,rnd(5)-2.5}
end
function mv(i,j)
	i+=j
	if i<0 then
		i=127
	elseif 127<i then
		i=0
	end
	return i
end
function dst(i1,i2,j1,j2)
	return sqrt((i1-j1)^2+(i2-j2)^2)
end
function len(i,j)
	return sqrt(i*i+j*j)
end
function norm(i,j)
	l=len(i,j)
	return {i/l,j/l}
end

::w::
cls(1)

for ii=1,10 do
	i=b[ii]
	
	l=len(i[3],i[4])
	current_dir=norm(i[3],i[4])
	
	line(i[1],i[2],i[1]+current_dir[1]*5,i[2]+current_dir[2]*5,8)
	pset(i[1],i[2],7)
	-- flok
	alf = {0,0}
	alft = 0
	for jj=1,10 do
		j=b[jj]
		d = dst(i[1],i[2],j[1],j[2])
		if d<15 then
			alf[1] += j[1]
			alf[2] += j[2]
			alft+=1
		end
	end
	-- affect
	use_steer=false
	steer={0,0}
	if 0<alft then
		alf[1]/=alft
		alf[2]/=alft
		steer=alf
		use_steer=true
	end
	if use_steer then
		steer=norm(steer[1],steer[2])
		--i[1] = i[1]*0.8+steer[1]*0.2
		--i[2] = i[2]*0.8+steer[2]*0.2
	end
	-- move them
	i[1]=mv(i[1],i[3])
	i[2]=mv(i[2],i[4])
end

flip()
goto w
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
